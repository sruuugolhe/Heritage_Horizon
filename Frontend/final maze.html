<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MindMap Maze ‚Äî India's Heritage</title>
  <style>
    /* ------------------------
       India Heritage MindMap Maze
       Single-file HTML/CSS/JS game
       Features:
         - Procedural maze generation (DFS)
         - Player navigates with arrow keys / WASD or touch
         - Heritage-site nodes placed in maze; collecting adds to mindmap
         - Right-hand mindmap canvas that arranges collected nodes and draws connections
         - Hints, timer, levels, sound toggle
    --------------------------*/

    :root{
      --bg:#fef6e4; /* warm parchment */
      --accent:#00695c; /* deep teal */
      --accent-2:#ff6f00; /* saffron */
      --muted:#6b6b6b;
      --card:#ffffff;
      --glass: rgba(255,255,255,0.7);
      --shadow: 0 8px 24px rgba(0,0,0,0.12);
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }

    html,body{height:100%;margin:0;background:linear-gradient(180deg, #e8f5f2 0%, var(--bg) 100%);color:#122;}
    .app{
      display:grid;
      grid-template-columns: 1fr 420px;
      gap:18px;
      padding:18px;
      height:100vh;
      box-sizing:border-box;
    }

    header{grid-column:1/-1;display:flex;align-items:center;gap:12px;padding:12px;border-radius:12px;background:linear-gradient(90deg, rgba(255,255,255,0.6), rgba(255,255,255,0.2));box-shadow:var(--shadow);}
    header h1{margin:0;font-size:20px;color:var(--accent);}
    header p{margin:0;color:var(--muted);font-size:13px}

    /* Left: the game area */
    .game-area{
      background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="800" height="600"><rect width="100%" height="100%" fill="%23f8f1e7"/></svg>') center/cover no-repeat, radial-gradient(circle at 20% 10%, rgba(255,255,255,0.6), transparent 30%);
      border-radius:12px;padding:12px;display:flex;flex-direction:column;box-shadow:var(--shadow);
    }

    .controls{display:flex;gap:8px;align-items:center;margin-bottom:10px}
    .controls > *{background:var(--card);border-radius:8px;padding:8px 12px;border:1px solid rgba(0,0,0,0.06);box-shadow:0 3px 8px rgba(0,0,0,0.04);}
    .btn{cursor:pointer;user-select:none}
    .btn.primary{background:linear-gradient(90deg,var(--accent),#00897b);color:white}

    .stage-wrap{display:flex;gap:12px;flex:1;align-items:stretch}
    .canvas-wrap{flex:1;background:linear-gradient(180deg, rgba(255,255,255,0.3), rgba(255,255,255,0.15));border-radius:8px;padding:8px;display:flex;flex-direction:column;}

    canvas{border-radius:8px;display:block;background:linear-gradient(180deg,#fffefc, #fffdf6)}

    /* Right: mindmap */
    .panel{background:linear-gradient(180deg, rgba(255,255,255,0.85), rgba(255,255,255,0.7));border-radius:12px;padding:12px;box-shadow:var(--shadow);overflow:auto}
    .panel h2{margin:0 0 8px 0;color:var(--accent)}

    .stats{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:8px}
    .stat{background:var(--glass);padding:8px;border-radius:8px;min-width:90px;text-align:center}
    .stat strong{display:block;font-size:18px}

    .mindmap-canvas{width:100%;height:56vh;border-radius:8px;background:linear-gradient(180deg,#fff,#fffaf0);border:1px dashed rgba(0,0,0,0.06);}

    .legend{display:flex;flex-direction:column;gap:6px;margin-top:8px}
    .legend-item{display:flex;gap:8px;align-items:center}
    .sw{width:18px;height:18px;border-radius:4px}

    footer{grid-column:1/-1;display:flex;justify-content:space-between;align-items:center;padding-top:6px;color:var(--muted);font-size:13px}

    /* responsive */
    @media (max-width:980px){
      .app{grid-template-columns:1fr;}
      .panel{order:2}
      .game-area{order:1}
    }

    /* touch controls overlay */
    .touch-controls{display:none;gap:6px;margin-top:8px}
    .touch-controls button{padding:10px;border-radius:8px}
    @media (max-width:680px){.touch-controls{display:flex}}

    /* small helper */
    .help{font-size:12px;color:var(--muted)}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>MindMap Maze ‚Äî India's Heritage</h1>
      <p>Explore, collect and map India's heritage sites. Use arrow keys or touch controls. Each collected site becomes a node in your mindmap.</p>
    </header>

    <section class="game-area">
      <div class="controls">
        <div class="btn primary" id="btn-new">New Maze</div>
        <div class="btn" id="btn-level">Level: <strong id="level">1</strong></div>
        <div class="btn" id="btn-hint">Hint</div>
        <div class="btn" id="btn-sound">üîä</div>
        <div style="margin-left:auto" class="help">Tip: Reach all heritage nodes to finish the level</div>
      </div>

      <div class="stage-wrap">
        <div class="canvas-wrap">
          <canvas id="mazeCanvas" width="820" height="600" aria-label="Maze"></canvas>
          <div class="touch-controls" id="touchControls">
            <button data-dir="up">‚ñ≤</button>
            <button data-dir="left">‚óÄ</button>
            <button data-dir="down">‚ñº</button>
            <button data-dir="right">‚ñ∂</button>
          </div>
        </div>
      </div>

    </section>

    <aside class="panel">
      <h2>Your Mindmap</h2>
      <div class="stats">
        <div class="stat"><small>Time</small><strong id="time">00:00</strong></div>
        <div class="stat"><small>Collected</small><strong id="collected">0</strong></div>
        <div class="stat"><small>Remaining</small><strong id="remaining">0</strong></div>
      </div>

      <canvas id="mindmap" class="mindmap-canvas" width="380" height="520" aria-label="Mindmap"></canvas>

      <div class="legend">
        <div class="legend-item"><div class="sw" style="background:var(--accent)"></div><div>Taj Mahal ‚Äî Agra</div></div>
        <div class="legend-item"><div class="sw" style="background:#c62828"></div><div>Qutub Minar ‚Äî Delhi</div></div>
        <div class="legend-item"><div class="sw" style="background:#2e7d32"></div><div>Hampi ‚Äî Karnataka</div></div>
        <div class="legend-item"><div class="sw" style="background:#6a1b9a"></div><div>Ajanta Caves ‚Äî Maharashtra</div></div>
        <div class="legend-item"><div class="sw" style="background:#ff8f00"></div><div>Kerala Backwaters ‚Äî Kerala</div></div>
      </div>

      <div style="margin-top:12px;display:flex;gap:8px;">
        <div class="btn" id="btn-export">Export Map</div>
        <div class="btn" id="btn-reset">Reset Collected</div>
      </div>

    </aside>

    <footer>
      <div>Made with ‚ù§Ô∏è ‚Äî India's Heritage MindMap Maze</div>
      <div class="help">Controls: Arrow keys / WASD / Touch</div>
    </footer>
  </div>

  <script>
    /* ----------------------------
       Game Logic (single-file)
    -----------------------------*/

    // Basic settings
    const CELL = 28; // cell size in px
    const COLS = 25; // grid width
    const ROWS = 20; // grid height

    // Heritage nodes to place (few examples)
    const HERITAGE = [
      {id:'andhra', name:'Charminar', place:'Andhra Pradesh', color:'#00695c', info:'Historic monument and mosque.'},
      {id:'arunachal', name:'Tawang Monastery', place:'Arunachal Pradesh', color:'#2e7d32', info:'Largest monastery in India.'},
      {id:'assam', name:'Kaziranga', place:'Assam', color:'#ff8f00', info:'World Heritage national park.'},
      {id:'bihar', name:'Nalanda', place:'Bihar', color:'#6a1b9a', info:'Ancient university ruins.'},
      {id:'chhattisgarh', name:'Bastar Fort', place:'Chhattisgarh', color:'#c62828', info:'Historic forts and tribal heritage.'},
      {id:'goa', name:'Basilica of Bom Jesus', place:'Goa', color:'#2a79a9', info:'Landmark of Goa with Baroque architecture.'},
      {id:'gujarat', name:'Rani ki Vav', place:'Gujarat', color:'#d84315', info:'Stepwell and UNESCO site.'},
      {id:'haryana', name:'Kurukshetra', place:'Haryana', color:'#7b1fa2', info:'Land of the Mahabharata.'},
      {id:'hp', name:'Kangra Fort', place:'Himachal Pradesh', color:'#1b5e20', info:'Ancient hill fort.'},
      {id:'jharkhand', name:'Deoghar', place:'Jharkhand', color:'#ef6c00', info:'Pilgrim town with historic temples.'},
      {id:'karnataka', name:'Hampi', place:'Karnataka', color:'#2e7d32', info:'Ruins of the Vijayanagara empire.'},
      {id:'kerala', name:'Kerala Backwaters', place:'Kerala', color:'#ff8f00', info:'Famous backwaters and houseboats.'},
      {id:'mp', name:'Khajuraho', place:'Madhya Pradesh', color:'#8e24aa', info:'Temple complex known for sculptures.'},
      {id:'maharashtra', name:'Ajanta Caves', place:'Maharashtra', color:'#6a1b9a', info:'Rock-cut Buddhist cave monuments.'},
      {id:'manipur', name:'Kangla Fort', place:'Manipur', color:'#4caf50', info:'Ancient capital and heritage site.'},
      {id:'meghalaya', name:'Living Root Bridges', place:'Meghalaya', color:'#00a152', info:'Unique living bridges carved by nature.'},
      {id:'mizoram', name:'Durtlang Hills', place:'Mizoram', color:'#388e3c', info:'Scenic hills with cultural sites.'},
      {id:'nagaland', name:'Khonoma', place:'Nagaland', color:'#6d4c41', info:'Historic village and heritage conservation.'},
      {id:'odisha', name:'Konark Sun Temple', place:'Odisha', color:'#f57c00', info:'13th-century temple and UNESCO site.'},
      {id:'punjab', name:'Golden Temple', place:'Punjab', color:'#ffd54f', info:'Holiest gurdwara and cultural center.'},
      {id:'rajasthan', name:'Amber Fort', place:'Rajasthan', color:'#ff7043', info:'Hilltop fort with Rajput architecture.'},
      {id:'sikkim', name:'Rumtek Monastery', place:'Sikkim', color:'#8e24aa', info:'Important Buddhist monastery.'},
      {id:'tamilnadu', name:'Mahabalipuram', place:'Tamil Nadu', color:'#29b6f6', info:'Shore temples and rock-cut sculptures.'},
      {id:'telangana', name:'Golconda Fort', place:'Telangana', color:'#6a1b9a', info:'Famous medieval fortress.'},
      {id:'tripura', name:'Unakoti', place:'Tripura', color:'#c2185b', info:'Ancient rock-cut reliefs.'},
      {id:'up', name:'Taj Mahal', place:'Uttar Pradesh', color:'#00695c', info:'Iconic monument of love in Agra.'},
      {id:'uttarakhand', name:'Badrinath', place:'Uttarakhand', color:'#2e7d32', info:'Historic temple and pilgrimage site.'},
      {id:'westbengal', name:'Victoria Memorial', place:'West Bengal', color:'#1e88e5', info:'Colonial-era monument in Kolkata.'},
      {id:'andaman', name:'Cellular Jail', place:'Andaman & Nicobar', color:'#7b1fa2', info:'Colonial prison with historic importance.'},
      {id:'ar', name:'Sela Pass', place:'Arunachal', color:'#0288d1', info:'High-altitude pass with historic routes.'},
      {id:'chandigarh', name:'Rock Garden', place:'Chandigarh', color:'#43a047', info:'Sculptural garden of reused materials.'},
      {id:'daman', name:'Diu Fort', place:'Daman & Diu', color:'#f4511e', info:'Coastal fort with Portuguese heritage.'},
      {id:'dadra', name:'Dudhani', place:'Dadra & Nagar Haveli', color:'#ff8f00', info:'Local historic and cultural sites.'},
      {id:'lakshadweep', name:'Minicoy Lighthouses', place:'Lakshadweep', color:'#0288d1', info:'Maritime heritage of the islands.'},
      {id:'puducherry', name:'French Quarter', place:'Puducherry', color:'#8e24aa', info:'Colonial-era streets and heritage.'},
      {id:'ladakh', name:'Thiksey Monastery', place:'Ladakh', color:'#6d4c41', info:'High-altitude monastery with heritage.'},
      {id:'jammu', name:'Shankaracharya Temple', place:'Jammu & Kashmir', color:'#ff7043', info:'Ancient temple overlooking the city.'}
    ];

    // Maximum levels and difficulty settings
    const MAX_LEVELS = 60; // total levels requested by player
    

    // State
    let level = 1; // current level (1..MAX_LEVELS)
    let mazeCanvas = document.getElementById('mazeCanvas');
    let mz = mazeCanvas.getContext('2d');
    let mindCanvas = document.getElementById('mindmap');
    let mg = mindCanvas.getContext('2d');
    let grid, visited, stack;
    let player = {x:1,y:1};
    let nodes = [];
    let collected = [];
    let startTime = null;
    let timerInterval = null;
    let soundOn = true;

    // Resize canvas to fit container while keeping internal resolution
    function fitCanvas(canvas, width, height){
      canvas.width = width;
      canvas.height = height;
    }

    fitCanvas(mazeCanvas, COLS*CELL, ROWS*CELL);
    fitCanvas(mindCanvas, 380, 520);

    function randInt(a,b){return Math.floor(Math.random()*(b-a+1))+a}

    // Maze generation: DFS backtracker
    function initMaze(){
      grid = Array.from({length:ROWS},()=>Array(COLS).fill(1)); // 1 = wall, 0 = passage
      visited = Array.from({length:ROWS},()=>Array(COLS).fill(false));
      stack = [];
      // start at odd coords
      let sx = 1, sy = 1;
      carve(sy,sx);
      player.x = sx; player.y = sy;
    }

    function carve(r,c){
      visited[r][c]=true; grid[r][c]=0;
      const dirs = [[0,-2],[0,2],[-2,0],[2,0]];
      shuffle(dirs);
      for(let d of dirs){
        let nr=r+d[0], nc=c+d[1];
        if(nr>0 && nr<ROWS-1 && nc>0 && nc<COLS-1 && !visited[nr][nc]){
          grid[(r+nr)/2][(c+nc)/2]=0; // knock down wall
          carve(nr,nc);
        }
      }
    }

    function shuffle(a){for(let i=a.length-1;i>0;i--){let j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}}

    // Place heritage nodes into random passage cells
    function placeNodes(){
      nodes = [];
      const pool = [...HERITAGE];
      shuffle(pool);
      // scale nodes by level to increase complexity: start with 3, add 1 every 5 levels up to pool length
      const base = 3;
      const additional = Math.min(Math.floor((level-1)/5), Math.max(0, pool.length - base));
      const count = Math.min(pool.length, base + additional);

      let attempts = 0;
      for(let i=0;i<count;i++){
        let placed=false;
        while(!placed && attempts<3000){
          attempts++;
          let rx = randInt(1,COLS-2), ry = randInt(1,ROWS-2);
          // make sure cell is passage and not too close to player or other nodes
          if(grid[ry][rx]===0 && distance(ry,rx,player.y,player.x)>6 && !nodes.find(n=>n.x===rx&&n.y===ry)){
            nodes.push({x:rx,y:ry,...pool[i]}); placed=true;
          }
        }
      }
      // update remaining counter
      document.getElementById('remaining').textContent = Math.max(0, nodes.length - collected.length);
    }

    function distance(a,b,c,d){return Math.hypot(a-c,b-d)}

    // Draw maze and nodes
    function drawMaze(){
      mz.clearRect(0,0,mazeCanvas.width,mazeCanvas.height);
      // background subtle
      mz.fillStyle = '#fffdf7'; mz.fillRect(0,0,mazeCanvas.width,mazeCanvas.height);

      for(let r=0;r<ROWS;r++){
        for(let c=0;c<COLS;c++){
          if(grid[r][c]===1){
            mz.fillStyle = '#d6c9b7';
            mz.fillRect(c*CELL,r*CELL,CELL,CELL);
          }
        }
      }

      // nodes
      for(let n of nodes){
        if(collected.find(x=>x.id===n.id)) continue;
        mz.beginPath(); mz.fillStyle = n.color; mz.strokeStyle='rgba(0,0,0,0.08)';
        mz.arc((n.x+0.5)*CELL,(n.y+0.5)*CELL,CELL*0.38,0,Math.PI*2); mz.fill(); mz.stroke();
        // small label
        mz.font = '11px Inter, Arial'; mz.fillStyle='#fff'; mz.textAlign='center'; mz.fillText(n.name.split(' ')[0],(n.x+0.5)*CELL,(n.y+0.5)*CELL+4);
      }

      // player
      const pX = (player.x+0.5)*CELL; const pY = (player.y+0.5)*CELL;
      mz.beginPath(); mz.fillStyle = '#003d33'; mz.arc(pX,pY,CELL*0.36,0,Math.PI*2); mz.fill();
      mz.fillStyle='rgba(255,255,255,0.85)'; mz.font='12px Inter, Arial'; mz.textAlign='center'; mz.fillText('YOU',pX,pY+4);

      // grid overlay (subtle)
      mz.strokeStyle='rgba(0,0,0,0.02)'; mz.lineWidth=1;
      for(let r=0;r<=ROWS;r++){mz.beginPath();mz.moveTo(0,r*CELL);mz.lineTo(COLS*CELL,r*CELL);mz.stroke()}
      for(let c=0;c<=COLS;c++){mz.beginPath();mz.moveTo(c*CELL,0);mz.lineTo(c*CELL,ROWS*CELL);mz.stroke()}
    }

    function stepPlayer(dx,dy){
      let nx = player.x + dx, ny = player.y + dy;
      if(nx<0||ny<0||ny>=ROWS||nx>=COLS) return;
      if(grid[ny][nx]===0){player.x=nx;player.y=ny; playSound('step'); checkNode(); drawMaze();}
    }

    function checkNode(){
      // check if player at a node
      for(let n of nodes){
        if(n.x===player.x && n.y===player.y && !collected.find(x=>x.id===n.id)){
          collected.push(n); document.getElementById('collected').textContent = collected.length; document.getElementById('remaining').textContent = nodes.length - collected.length;
          playSound('collect'); showInfo(n); updateMindmap();
          if(collected.length===nodes.length){levelComplete()}
        }
      }
    }

    function showInfo(n){
      // small toast
      const t = document.createElement('div');
      t.style.position='fixed';t.style.right='20px';t.style.bottom='20px';t.style.background='linear-gradient(90deg, rgba(255,255,255,0.95), rgba(255,255,255,0.9))';t.style.padding='12px 16px';t.style.borderRadius='10px';t.style.boxShadow='0 8px 30px rgba(0,0,0,0.12)';t.style.zIndex=9999;
      t.innerHTML = `<strong style='color:${n.color}'>${n.name}</strong><div style='font-size:12px;color:#666'>${n.place} ‚Äî ${n.info}</div>`;
      document.body.appendChild(t);
      setTimeout(()=>{t.style.transition='all 350ms';t.style.opacity=0;setTimeout(()=>t.remove(),360)},3500);
    }

    function updateMindmap(){
      mg.clearRect(0,0,mindCanvas.width,mindCanvas.height);
      // background gentle pattern
      mg.fillStyle='#fff9f3'; mg.fillRect(0,0,mindCanvas.width,mindCanvas.height);

      // draw nodes in a circular layout based on collected order
      const cx = mindCanvas.width/2, cy = 80;
      // draw central title
      mg.beginPath(); mg.fillStyle='#ffe9cf'; mg.strokeStyle='rgba(0,0,0,0.06)'; mg.arc(cx,cy,60,0,Math.PI*2); mg.fill(); mg.stroke();
      mg.fillStyle= '#6b2e0f'; mg.font='16px Inter, Arial'; mg.textAlign='center'; mg.fillText('India\'s Heritage',cx,cy+6);

      // place nodes below
      const startY = 180; const gapY = 82;
      const w = 120; let idx=0;
      for(let n of collected){
        const x = 36 + (idx%3)*(w+6);
        const y = startY + Math.floor(idx/3)*gapY;
        // draw connector from center to node
        mg.beginPath(); mg.strokeStyle = n.color; mg.lineWidth=2; mg.moveTo(cx,cy+50); mg.lineTo(x+48,y-12); mg.stroke();
        // draw node card
        mg.fillStyle = n.color; mg.fillRect(x,y,116,56);
        mg.fillStyle='rgba(255,255,255,0.95)'; mg.font='12px Inter, Arial'; mg.textAlign='left'; mg.fillText(n.name, x+8, y+20); mg.fillStyle='rgba(255,255,255,0.9)'; mg.fillText(n.place, x+8, y+38);
        idx++;
      }

      // small footer
      mg.fillStyle='#666'; mg.font='11px Inter, Arial'; mg.textAlign='center'; mg.fillText(`Collected ${collected.length} / ${nodes.length}`, mindCanvas.width/2, mindCanvas.height-12);
    }

    function levelComplete(){
      playSound('win');
      clearInterval(timerInterval);
      const t = document.createElement('div');
      t.style.position='fixed';t.style.left='50%';t.style.top='40%';t.style.transform='translate(-50%,-50%)';t.style.background='linear-gradient(90deg,#fff,#fffefc)';t.style.padding='18px 22px';t.style.borderRadius='12px';t.style.boxShadow='0 12px 40px rgba(0,0,0,0.2)';
      t.innerHTML = `<h3 style='margin:0;color:#0b6b58'>Level ${level} complete!</h3><p style='margin:8px 0 0 0;color:#555'>You mapped ${collected.length} sites.</p><div style='display:flex;gap:8px;margin-top:12px'><button id='btn-next' style='padding:8px 12px;border-radius:8px'>Next level</button><button id='btn-close' style='padding:8px 12px;border-radius:8px'>Close</button></div>`;
      document.body.appendChild(t);
      document.getElementById('btn-next').onclick = ()=>{level++; document.getElementById('level').textContent = level; document.body.removeChild(t); startNew();}
      document.getElementById('btn-close').onclick = ()=>{document.body.removeChild(t)}
    }

    // Timer
    function startTimer(){startTime = Date.now(); if(timerInterval) clearInterval(timerInterval); timerInterval = setInterval(()=>{const s = Math.floor((Date.now()-startTime)/1000); document.getElementById('time').textContent = formatTime(s);},250)}
    function formatTime(s){const mm = String(Math.floor(s/60)).padStart(2,'0'); const ss = String(s%60).padStart(2,'0'); return `${mm}:${ss}`}

    // Sounds (simple beeps using WebAudio)
    const audioCtx = new (window.AudioContext||window.webkitAudioContext)();
    function playSound(type){ if(!soundOn) return; try{
      const o = audioCtx.createOscillator(); const g = audioCtx.createGain();
      o.connect(g); g.connect(audioCtx.destination);
      if(type==='step'){o.frequency.value = 880; g.gain.value = 0.02; o.start(); setTimeout(()=>o.stop(),50)}
      else if(type==='collect'){o.frequency.value=660; g.gain.value=0.05; o.start(); setTimeout(()=>o.stop(),220)}
      else if(type==='win'){o.frequency.value=520; g.gain.value=0.06; o.start(); setTimeout(()=>o.stop(),520)}
    }catch(e){/* audio locked on some browsers until interaction */}}

    // Controls
    document.addEventListener('keydown', (e)=>{
      const key = e.key.toLowerCase();
      if(['arrowup','w'].includes(e.key.toLowerCase())||key==='w'){ stepPlayer(0,-1) }
      else if(['arrowdown','s'].includes(e.key.toLowerCase())||key==='s'){ stepPlayer(0,1) }
      else if(['arrowleft','a'].includes(e.key.toLowerCase())||key==='a'){ stepPlayer(-1,0) }
      else if(['arrowright','d'].includes(e.key.toLowerCase())||key==='d'){ stepPlayer(1,0) }
    });

    document.getElementById('touchControls').addEventListener('click', (e)=>{ if(e.target.matches('button')){const d=e.target.dataset.dir; if(d==='up') stepPlayer(0,-1); if(d==='down') stepPlayer(0,1); if(d==='left') stepPlayer(-1,0); if(d==='right') stepPlayer(1,0);}});

    document.getElementById('btn-new').addEventListener('click', ()=>{level=1; document.getElementById('level').textContent = level; startNew()});
    document.getElementById('btn-hint').addEventListener('click', ()=>{showHint();});
    document.getElementById('btn-level').addEventListener('click', ()=>{level++; document.getElementById('level').textContent = level; startNew();});
    document.getElementById('btn-sound').addEventListener('click', ()=>{soundOn=!soundOn; document.getElementById('btn-sound').textContent = soundOn? 'üîä':'üîá'});
    document.getElementById('btn-reset').addEventListener('click', ()=>{collected=[]; document.getElementById('collected').textContent=0; updateMindmap(); document.getElementById('remaining').textContent = nodes.length});

    document.getElementById('btn-export').addEventListener('click', ()=>{
      const link = mindCanvas.toDataURL(); const a=document.createElement('a'); a.href=link; a.download = `mindmap-level${level}.png`; a.click();
    });

    // hint: show path to nearest uncollected node (BFS)
    function showHint(){
      const target = nodes.find(n=>!collected.find(c=>c.id===n.id)); if(!target) return;
      const path = bfs([player.x,player.y],[target.x,target.y]);
      if(!path) return;
      // draw overlay
      let i=0; const iv = setInterval(()=>{
        drawMaze(); mz.fillStyle='rgba(255,235,205,0.9)';
        for(let k=0;k<path.length;k++){mz.beginPath(); mz.fillRect(path[k][0]*CELL+CELL*0.28,path[k][1]*CELL+CELL*0.28,CELL*0.44,CELL*0.44)}
        i++; if(i>40){clearInterval(iv); drawMaze();}
      },80);
    }

    // BFS pathfinder on grid
    function bfs(start,goal){
      const q=[start]; const prev={}; prev[start]=null; const key=(p)=>`${p[0]},${p[1]}`;
      const seen = new Set(); seen.add(key(start));
      while(q.length){const cur = q.shift(); if(cur[0]===goal[0]&&cur[1]===goal[1]){ // reconstruct
          const out=[]; let c=goal; while(c){out.unshift(c); c = prev[key(c)];} return out;
        }
        const dirs=[[1,0],[-1,0],[0,1],[0,-1]];
        for(let d of dirs){const nx=cur[0]+d[0], ny=cur[1]+d[1]; if(nx<0||ny<0||ny>=ROWS||nx>=COLS) continue; if(grid[ny][nx]!==0) continue; const k=key([nx,ny]); if(seen.has(k)) continue; seen.add(k); prev[k]=cur; q.push([nx,ny]); }
      }
      return null;
    }

    // Start a new game/level
    function startNew(){
      initMaze(); placeNodes(); collected=[]; document.getElementById('collected').textContent=0; document.getElementById('level').textContent = level; document.getElementById('remaining').textContent = nodes.length; updateMindmap(); drawMaze(); startTimer();
      // add difficulty by adding some extra walls per level
      // (we keep simple here but could increase node count or shrink cell size)
    }

    // init
    startNew();

    // Expose small debug helpers (console)
    window.MindMapMaze = {startNew, drawMaze, updateMindmap};

  </script>
</body>
</html>
