<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Student Dashboard</title>

<style>
body{
    margin:0;
    font-family:Segoe UI;
    background:#071a1e;
    color:#eafff7;
}

/* Main container */
.container{
    max-width:950px;
    margin:40px auto;
    padding:30px;
    border:3px solid #36f5c7;
    border-radius:20px;
    box-shadow:0 0 25px #36f5c7;
}

/* Profile Section */
.profile-section{
    display:flex;
    align-items:center;
    gap:20px;
    margin-bottom:30px;
    padding-bottom:20px;
    border-bottom:1px solid #36f5c7;
}

.profile-img{
    width:120px;
    height:120px;
    border-radius:50%;
    object-fit:cover;
    border:3px solid #36f5c7;
}

.profile-info h2{
    margin:0;
    font-size:24px;
}

.profile-info p{
    margin:5px 0;
    color:#9fffe8;
}

/* Cards */
.card{
    background:#0f2f34;
    padding:20px;
    border-radius:12px;
    border:1px solid #36f5c7;
    margin-bottom:20px;
}
.card p{
    font-size:20px;   /* was default, now slightly bigger */
    font-weight:bold;
}

/* Premium Button */
.card button{
    padding:12px 30px;
    font-size:16px;
    font-weight:bold;
    border:none;
    border-radius:30px;
    background:linear-gradient(45deg,#00ffcc,#36f5c7);
    cursor:pointer;
    transition:0.3s;
    box-shadow:0 0 15px #36f5c7;
}

.card button:hover{
    transform:scale(1.1);
    box-shadow:0 0 30px #00ffcc;
}

/* POPUP */
.popup{
    display:none;
    position:fixed;
    inset:0;
    background:rgba(0,0,0,0.8);
    backdrop-filter:blur(6px);
    justify-content:center;
    align-items:center;
    z-index:9999;
}

.popup-content{
    background:linear-gradient(145deg,#0f2f34,#123f45);
    padding:40px;
    border-radius:25px;
    text-align:center;
    width:480px;
    border:2px solid #36f5c7;
    box-shadow:0 0 40px #36f5c7;
    animation:popupFade 0.4s ease;
}

@keyframes popupFade{
    from{transform:scale(0.8); opacity:0;}
    to{transform:scale(1); opacity:1;}
}

/* Box Grid */
.box-grid{
    display:grid;
    grid-template-columns:repeat(3, 110px);
    gap:20px;
    justify-content:center;
    margin-top:20px;
}

/* Mystery Box */
.mystery-box{
    width:110px;
    height:110px;
    background:linear-gradient(145deg,#36f5c7,#00ffaa);
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:42px;
    border-radius:20px;
    cursor:pointer;
    transition:0.4s;
    transform-style:preserve-3d;
}

.mystery-box:hover{
    transform:rotateY(10deg) scale(1.1);
}

/* Flip Animation */
.flip{
    animation:flipBox 0.6s ease;
}

@keyframes flipBox{
    0%{transform:rotateY(0deg);}
    50%{transform:rotateY(180deg);}
    100%{transform:rotateY(0deg);}
}

/* Back Button */
.popup-content button{
    margin-top:20px;
    padding:10px 20px;
    border:none;
    border-radius:8px;
    background:#36f5c7;
    cursor:pointer;
}
</style>
</head>

<body>

<div class="container">

    <div class="profile-section">
        <img src="{{ url_for('static', filename='profile.png') }}" class="profile-img">
        <div class="profile-info">
            <h2>{{ user['username'] }}</h2>
            <p>Level: {{ user['level'] }}</p>
        </div>
    </div>

    <div class="card">
        <h3>游뿣 Coins</h3>
        <p>{{ user['coins'] }}</p>
    </div>

    <div class="card">
        <h3>游꿢 Total Score</h3>
        <p>{{ total_score }}</p>
    </div>

    <div class="card">
        <h3>游꿡 Games Played</h3>
        <p>{{ total_games_played }}</p>
    </div>

    <div class="card">
        <h3>游꾸 Mystery Reward</h3>
        <button onclick="openMystery()">Open Mystery</button>
    </div>

</div>

<!-- POPUP -->
<div id="mystery-popup" class="popup">
    <div class="popup-content">
        <h2>游꾸 Choose One Box</h2>

        <div class="box-grid">
            {% for i in range(9) %}
            <div class="mystery-box" onclick="openBox(this)">游꾸</div>
            {% endfor %}
        </div>

        <p id="reward-text"></p>

        <button onclick="closeMystery()">Back</button>
    </div>
</div>

<!-- Sound -->
<audio id="winSound" src="https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3"></audio>

<script>
let opened = false;

function openMystery(){
    document.getElementById("mystery-popup").style.display="flex";
    opened=false;
    document.getElementById("reward-text").innerHTML="";
    document.querySelectorAll(".mystery-box").forEach(box=>{
        box.innerHTML="游꾸";
        box.classList.remove("flip");
    });
}

function closeMystery(){
    document.getElementById("mystery-popup").style.display="none";
    location.reload();
}

function openBox(box){
    if(opened) return;
    opened=true;

    box.classList.add("flip");

    fetch("/mystery_reward")
    .then(res=>res.json())
    .then(data=>{
        let reward=data.reward;
        let text=document.getElementById("reward-text");

        box.innerHTML=reward;

        if(reward==0){
            text.innerHTML="游땩 No coins this time!";
        }else{
            text.innerHTML="游꿀 You won "+reward+" coins!";
            document.getElementById("winSound").play();
        }
    });
}

/* Confetti */

</script>

</body>
</html>