<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Student Dashboard</title>

<style>
body{
    margin:0;
    font-family:Segoe UI;
    background:#071a1e;
    color:#eafff7;
}

.container{
    max-width:1100px;
    margin:40px auto;
    padding:20px;
    border:3px solid #36f5c7;
    border-radius:20px;
    box-shadow:0 0 25px #36f5c7;
}

.top{
    display:flex;
    justify-content:space-between;
    align-items:center;
}

.card{
    background:#0f2f34;
    padding:15px;
    border-radius:12px;
    border:1px solid #36f5c7;
    margin-top:20px;
}

button{
    padding:8px 15px;
    background:#36f5c7;
    border:none;
    border-radius:8px;
    cursor:pointer;
}
button:hover{
    transform:scale(1.05);
}

/* ---------------- POPUP ---------------- */

.popup{
    display:none;
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background:rgba(0,0,0,0.85);
    justify-content:center;
    align-items:center;
    z-index:9999;
}

.popup-content{
    background:#0f2f34;
    padding:30px;
    border-radius:20px;
    text-align:center;
    position:relative;
}

/* ---------------- WHEEL ---------------- */

.wheel-wrapper{
    position:relative;
    width:350px;
    margin:20px auto;
}

.wheel{
    width:320px;
    height:320px;
    border-radius:50%;
    border:8px solid #36f5c7;
    transition: transform 4s ease-out;
    margin:auto;

    background: conic-gradient(
        #00ffaa 0deg 45deg,
        #00ffcc 45deg 90deg,
        #00ffaa 90deg 135deg,
        #00ffcc 135deg 180deg,
        #00ffaa 180deg 225deg,
        #00ffcc 225deg 270deg,
        #00ffaa 270deg 315deg,
        #00ffcc 315deg 360deg
    );
}

/* Arrow - fixed */
.arrow{
    position:absolute;
    top:-28px;
    left:50%;
    transform:translateX(-50%);
    width:0;
    height:0;
    border-left:18px solid transparent;
    border-right:18px solid transparent;
    border-top:35px solid #ffcc00; /* downward arrow */
    z-index:10;
}

/* Center circle */
.center-circle{
    position:absolute;
    width:70px;
    height:70px;
    background:#071a1e;
    border-radius:50%;
    top:50%;
    left:50%;
    transform:translate(-50%,-50%);
    border:5px solid #36f5c7;
}

/* Labels - perfectly centered in each slice */
.label{
    position:absolute;
    width:100%;
    height:100%;
    display:flex;
    justify-content:center;
    align-items:flex-start;
    transform-origin:50% 50%;
    font-weight:bold;
    font-size:18px;
    color:#000;
    pointer-events:none;
}

.label span{
    position:absolute;
    top:18%;
    left:50%;
    transform:translateX(-50%);
}
</style>
</head>

<body>

<h1 style="text-align:center;">TEST DASHBOARD VERSION 2</h1>

<div class="container">

<div class="top">
    <h2>Welcome, {{ user['username'] }}</h2>
    <h3>Level {{ user['level'] }}</h3>
</div>

<div class="card">
    <h3>Coins: {{ user['coins'] }} ðŸª™</h3>
</div>

<div class="card">
    <h3>ðŸŽ¡ Spin The Wheel</h3>
    <button onclick="openWheel()">Spin Now</button>
</div>

<!-- WHEEL POPUP -->
<div id="wheel-popup" class="popup">
    <div class="popup-content">

        <div class="wheel-wrapper">

            <div class="arrow"></div>

            <div class="wheel" id="wheel">

                <!-- Rotated by +22.5deg to center inside slices -->
                <div class="label" style="transform:rotate(22.5deg);"><span>10</span></div>
                <div class="label" style="transform:rotate(67.5deg);"><span>20</span></div>
                <div class="label" style="transform:rotate(112.5deg);"><span>0</span></div>
                <div class="label" style="transform:rotate(157.5deg);"><span>50</span></div>
                <div class="label" style="transform:rotate(202.5deg);"><span>100</span></div>
                <div class="label" style="transform:rotate(247.5deg);"><span>0</span></div>
                <div class="label" style="transform:rotate(292.5deg);"><span>30</span></div>
                <div class="label" style="transform:rotate(337.5deg);"><span>70</span></div>

            </div>

            <div class="center-circle"></div>

        </div>

        <br>
        <button onclick="startSpin()">Spin</button>
        <button onclick="closeWheel()">Close</button>

        <p id="result-text"></p>
    </div>
</div>

<audio id="spin-sound" src="https://assets.mixkit.co/active_storage/sfx/2003/2003-preview.mp3"></audio>

</div>

<script>

const rewards = [10,20,0,50,100,0,30,70];
let spinning = false;

function startSpin(){

    if(spinning) return;
    spinning = true;

    const wheel = document.getElementById("wheel");
    const resultText = document.getElementById("result-text");
    const sound = document.getElementById("spin-sound");

    let randomIndex = Math.floor(Math.random() * rewards.length);
    let reward = rewards[randomIndex];

    let degreePerSection = 360 / rewards.length;

    // ðŸ”¥ corrected alignment
    let stopDegree = 360 - (randomIndex * degreePerSection);

    let totalRotation = 360 * 5 + stopDegree;

    wheel.style.transform = "rotate(" + totalRotation + "deg)";
    sound.play();

    setTimeout(() => {

        fetch("/spin?reward=" + reward)
        .then(res => res.json())
        .then(data => {
            resultText.innerHTML = "ðŸŽ‰ You won " + data.reward + " coins!";
            spinning = false;
        });

    }, 4000);
}


function openWheel(){
    document.getElementById("wheel-popup").style.display = "flex";
}

function closeWheel(){
    document.getElementById("wheel-popup").style.display = "none";
}

</script>

</body>
</html>
