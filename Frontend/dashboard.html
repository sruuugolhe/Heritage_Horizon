<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Student Dashboard</title>

<style>
body{
    margin:0;
    font-family:Segoe UI;
    background:#071a1e;
    color:#eafff7;
}

.container{
    max-width:1100px;
    margin:40px auto;
    padding:20px;
    border:3px solid #36f5c7;
    border-radius:20px;
    box-shadow:0 0 25px #36f5c7;
}

.top{
    display:flex;
    justify-content:space-between;
    align-items:center;
}

.card{
    background:#0f2f34;
    padding:15px;
    border-radius:12px;
    border:1px solid #36f5c7;
    margin-top:20px;
}

button{
    padding:8px 15px;
    background:#36f5c7;
    border:none;
    border-radius:8px;
    cursor:pointer;
}
button:hover{
    transform:scale(1.05);
}

.progress-bar{
    width:100%;
    background:#1c4449;
    border-radius:10px;
    height:20px;
    margin-top:10px;
}

.progress-fill{
    height:100%;
    background:linear-gradient(90deg,#00ffcc,#00ffaa);
    border-radius:10px;
}
.popup{
    display:none;
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background:rgba(0,0,0,0.8);
    justify-content:center;
    align-items:center;
}

.popup-content{
    background:#0f2f34;
    padding:30px;
    border-radius:20px;
    text-align:center;
}

.wheel{
    width:250px;
    height:250px;
    border-radius:50%;
    margin:20px auto;
    border:8px solid #36f5c7;
    background:conic-gradient(
        #00ffcc 0% 25%,
        #00ffaa 25% 50%,
        #00ffcc 50% 75%,
        #00ffaa 75% 100%
    );
    transition: transform 4s ease-out;
}
.popup{
    display:none;
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background:rgba(0,0,0,0.8);
    justify-content:center;
    align-items:center;
}

.popup-content{
    background:#0f2f34;
    padding:30px;
    border-radius:20px;
    text-align:center;
    position:relative;
}

.wheel{
    position:relative;
    width:320px;
    height:320px;
    border-radius:50%;
    margin:20px auto;
    border:8px solid #36f5c7;
    transition: transform 4s ease-out;

    background: conic-gradient(
        #00ffaa 0deg 45deg,
        #00ffcc 45deg 90deg,
        #00ffaa 90deg 135deg,
        #00ffcc 135deg 180deg,
        #00ffaa 180deg 225deg,
        #00ffcc 225deg 270deg,
        #00ffaa 270deg 315deg,
        #00ffcc 315deg 360deg
    );
}

/* Labels */
.label{
    position:absolute;
    width:100%;
    height:100%;
    text-align:center;
    transform: rotate(calc(var(--i) * 45deg));
}

.label::after{
    content: attr(style);
}

.label{
    font-weight:bold;
    font-size:18px;
    color:#000;
}

.label span{
    position:absolute;
}

/* Position reward text */
.label{
    display:flex;
    justify-content:center;
    align-items:flex-start;
    padding-top:20px;
}

/* Proper Arrow */
.arrow{
    width:0;
    height:0;
    border-left:20px solid transparent;
    border-right:20px solid transparent;
    border-bottom:35px solid #ffcc00;
    margin:0 auto;
}


</style>
</head>
<script>
    const bar = document.querySelector('.progress-bar');
    const progress = bar.getAttribute('data-progress');

    let width = 0;
    const interval = setInterval(() => {
        if (width >= progress) {
            clearInterval(interval);
        } else {
            width++;
            bar.style.width = width + "%";
        }
    }, 10);
</script>
<script>

</script>

<body>

<div class="container">

<div class="top">
    <h2>Welcome, {{ user['username'] }}</h2>
    <h3>Level {{ user['level'] }}</h3>
</div>

<div class="card">
    <h3>Coins: {{ user['coins'] }} ðŸª™</h3>
</div>

<div class="card">
    <h3>Overall Progress</h3>

<p>{{ completed_games }} / {{ total_games }} Games Completed</p>

<div class="progress-bar-container">
    <div class="progress-bar" data-progress="{{ progress_percent }}">
    {{ progress_percent }}%
</div>

</div>

</div>

<div class="card">
    <h3>ðŸŽ¡ Spin The Wheel</h3>
    <button onclick="openWheel()">Spin Now</button>
</div>

<!-- WHEEL POPUP -->
<div id="wheel-popup" class="popup">
    <div class="popup-content">

        <!-- Arrow Pointer -->
        <div class="arrow"></div>

        <!-- Wheel -->
        <div class="wheel" id="wheel">
            <div class="label" style="--i:0">10</div>
            <div class="label" style="--i:1">20</div>
            <div class="label" style="--i:2">0</div>
            <div class="label" style="--i:3">50</div>
            <div class="label" style="--i:4">100</div>
            <div class="label" style="--i:5">0</div>
            <div class="label" style="--i:6">30</div>
            <div class="label" style="--i:7">70</div>
        </div>

        <button onclick="startSpin()">Spin</button>
        <button onclick="closeWheel()">Close</button>

        <p id="result-text"></p>
    </div>
</div>


<audio id="spin-sound" src="https://assets.mixkit.co/active_storage/sfx/2003/2003-preview.mp3"></audio>



</div>

<script>

const rewards = [10,20,0,50,100,0,30,70];

function startSpin(){

    const wheel = document.getElementById("wheel");
    const resultText = document.getElementById("result-text");
    const sound = document.getElementById("spin-sound");

    let reward = rewards[Math.floor(Math.random() * rewards.length)];

    let index = rewards.indexOf(reward);

    let degreePerSection = 360 / rewards.length;
    let stopDegree = (index * degreePerSection) + (degreePerSection / 2);

    let totalRotation = 1440 + (360 - stopDegree);

    wheel.style.transform = "rotate(" + totalRotation + "deg)";

    sound.play();

    setTimeout(() => {

        fetch("/spin?reward=" + reward)
        .then(res => res.json())
        .then(data => {
            resultText.innerHTML = "ðŸŽ‰ You won " + reward + " coins!";
            setTimeout(() => location.reload(), 2000);
        });

    }, 4000);
}

</script>

</body>
</html>
